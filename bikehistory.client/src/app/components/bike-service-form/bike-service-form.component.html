<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>{{ isEditMode ? '정비 기록 수정' : '새 정비 기록 등록' }}</h2>
    <a [routerLink]="['/service-records']" class="btn btn-outline-secondary">
      <i class="bi bi-x-circle"></i> 취소
    </a>
  </div>

  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">로딩 중...</span>
    </div>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <form [formGroup]="serviceForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <!-- 기본 정보 -->
          <div class="col-md-6">
            <h4 class="mb-3">기본 정보</h4>

            <div class="mb-3">
              <label for="serviceDate" class="form-label">정비일자 *</label>
              <input type="date" class="form-control" id="serviceDate" formControlName="serviceDate" 
                [ngClass]="{'is-invalid': serviceForm.get('serviceDate')?.invalid && serviceForm.get('serviceDate')?.touched}">
              <div class="invalid-feedback">정비일자를 입력해주세요.</div>
            </div>

            <div class="mb-3">
              <label for="bikeFrameId" class="form-label">자전거 프레임 *</label>
              <select class="form-select" id="bikeFrameId" formControlName="bikeFrameId"
                [ngClass]="{'is-invalid': serviceForm.get('bikeFrameId')?.invalid && serviceForm.get('bikeFrameId')?.touched}">
                <option value="">자전거 프레임 선택</option>
                <option *ngFor="let bike of bikeFrames" [value]="bike.id">
                  {{ bike.frameNumber }} {{ bike.model ? '- ' + bike.model : '' }}
                </option>
              </select>
              <div class="invalid-feedback">자전거 프레임을 선택해주세요.</div>
            </div>

            <div class="mb-3">
              <label for="serviceType" class="form-label">정비 유형 *</label>
              <select class="form-select" id="serviceType" formControlName="serviceType">
                <option [value]="ServiceType.Maintenance">유지보수</option>
                <option [value]="ServiceType.Repair">수리</option>
                <option [value]="ServiceType.Inspection">점검</option>
                <option [value]="ServiceType.Upgrade">업그레이드</option>
                <option [value]="ServiceType.Custom">맞춤 서비스</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="serviceStatus" class="form-label">정비 상태 *</label>
              <select class="form-select" id="serviceStatus" formControlName="serviceStatus">
                <option [value]="ServiceStatus.Scheduled">예약됨</option>
                <option [value]="ServiceStatus.InProgress">진행 중</option>
                <option [value]="ServiceStatus.Completed">완료됨</option>
                <option [value]="ServiceStatus.Canceled">취소됨</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="cost" class="form-label">정비 비용</label>
              <div class="input-group">
                <span class="input-group-text">₩</span>
                <input type="number" class="form-control" id="cost" formControlName="cost" placeholder="0">
              </div>
            </div>
          </div>
          
          <!-- 추가 정보 -->
          <div class="col-md-6">
            <h4 class="mb-3">추가 정보</h4>
            
            <div class="mb-3">
              <label for="partDetails" class="form-label">사용 부품 정보</label>
              <textarea class="form-control" id="partDetails" rows="3" formControlName="partDetails" 
                placeholder="사용한 부품의 상세 정보를 입력하세요"></textarea>
            </div>
            
            <div class="mb-3">
              <label for="warrantyInfo" class="form-label">보증 정보</label>
              <textarea class="form-control" id="warrantyInfo" rows="2" formControlName="warrantyInfo"
                placeholder="보증 관련 정보를 입력하세요"></textarea>
            </div>
            
            <div class="mb-3">
              <label for="nextServiceDate" class="form-label">다음 정비 권장일</label>
              <input type="date" class="form-control" id="nextServiceDate" formControlName="nextServiceDate">
            </div>
          </div>
        </div>
        
        <!-- 정비 상세 내역 -->
        <div class="row mt-3">
          <div class="col-12">
            <div class="mb-3">
              <label for="serviceDetails" class="form-label">정비 상세 내역 *</label>
              <textarea class="form-control" id="serviceDetails" rows="5" formControlName="serviceDetails" 
                placeholder="수행한 정비 작업에 대한 상세 내역을 입력하세요"
                [ngClass]="{'is-invalid': serviceForm.get('serviceDetails')?.invalid && serviceForm.get('serviceDetails')?.touched}"></textarea>
              <div class="invalid-feedback">정비 내역을 입력해주세요.</div>
            </div>
          </div>
        </div>
        
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
          <button type="submit" class="btn btn-primary" [disabled]="serviceForm.invalid || isLoading">
            {{ isEditMode ? '저장' : '등록' }}
            <i class="bi bi-check-circle ms-1"></i>
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
